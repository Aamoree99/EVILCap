<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="logo.ico">
    <title>Moon Mining - Evil Capybara Incorporated</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            color: #f0ad4e;
        }
        .top-block {
            border: 2px solid #f0ad4e;
            padding: 10px;
            margin-bottom: 20px;
            text-align: center;
            flex: 1;
            margin-right: 10px;
        }
        .top-block:last-child {
            margin-right: 0;
        }
        .top-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .highlight {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .welcome-text {
            margin: 30px 0;
            text-align: center;
            font-size: 18px;
            color: #ffc107;
        }
        .alliance-name {
            text-align: center;
            font-size: 36px;
            color: #ffdf00;
            text-shadow: 2px 2px 5px #000;
            margin-bottom: 50px;
        }
        .footer {
            text-align: center;
            padding: 10px;
            margin-top: 20px;
            border-top: 1px solid #ffc107;
        }
        a {
            color: #ffc107;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .table {
            background-color: #2c2c2c; /* Однородный серый фон */
            color: #f0ad4e; /* Оранжевый текст */
        }
        .table th, .table td {
            border: 1px solid #555555;
        }
        .table th {
            background-color: #444444; /* Темный фон для заголовков */
            color: #f0ad4e; /* Оранжевый текст для заголовков */
        }
        .table td {
            background-color: #2c2c2c; /* Однородный фон для всех строк */
        }
        .btn {
            background-color: #ffc107;
            color: #1a1a1a;
            border: 2px solid #ffc107;
            border-radius: 0; /* Острые углы */
        }
        .btn:hover {
            background-color: #ffb000;
            border-color: #ffb000;
        }
        .button-container {
            display: flex;
            justify-content: center; /* Центрирование кнопок */
            gap: 20px; /* Расстояние между кнопками */
            margin-bottom: 20px;
        }
        section {
    display: flex;
    overflow-x: hidden;
}

.marquee {
    font-size: 24px; /* Размер шрифта, адаптированный для вашей страницы */
    font-family: sans-serif;
    line-height: 1.3;
    padding: 24px 0;
    white-space: nowrap;
    display: inline-block;
}

.marquee1 {
    animation: marquee1 90s infinite linear;
    animation-delay: -90s;
}

.marquee2 {
    animation: marquee2 90s infinite linear;
    animation-delay: -45s;
}

.marquee:after {
    content: ' ';
}

@keyframes marquee1 {
    0% {
        transform: translateX(100%);
    }
    100% {
        transform: translateX(-100%);
    }
}

@keyframes marquee2 {
    0% {
        transform: translateX(0%);
    }
    100% {
        transform: translateX(-200%);
    }
}
    </style>
</head>
<body> 
    <section style="width: 100vw;">
        <div class="marquee marquee1">
            Total Mined Volume: <%= dailyData.volume_sum %> | 
            Total Mined Quantity: <%= dailyData.quantity_sum %> | 
            Total ISK Paid: <%= dailyData.payout_sum %> | 
            Total Tax Paid: <%= dailyData.tax_sum %> | 
            Most Common Mined Material: <%= dailyData.most_common_material %> | 
        </div>
        <div class="marquee marquee2">
            Total Mined Volume: <%= dailyData.volume_sum %> | 
            Total Mined Quantity: <%= dailyData.quantity_sum %> | 
            Total ISK Paid: <%= dailyData.payout_sum %> | 
            Total Tax Paid: <%= dailyData.tax_sum %> | 
            Most Common Mined Material: <%= dailyData.most_common_material %> | 
        </div>
    </section>    
    <%- include('donation_banner') %>
    <div class="welcome-text">
        <p>Welcome to the Moon Mining page of Evil Capybara Incorporated, where we conquer the stars with efficiency and flair!</p>
    </div>
    <div class="alliance-name">
        Evil Capybara Incorporated
    </div>
    <div class="container mt-5">
        <div class="button-container">
            <!-- <a href="/fits" class="btn">Fits</a> 
            <a href="/stats" class="btn">Alts</a> -->
            <a href="/rules" class="btn">Rules</a>
            <a href="/stats" class="btn">Stats</a>
            <a href="/logs" class="btn">Logs</a>
        </div>      
        <div class="top-container">
            <div class="top-block">
                <div class="highlight">Monthly Top Quantity</div>
                <div>
                    <% if (topQuantity && topQuantity.miner && topQuantity.quantity) { %>
                        <%= topQuantity.miner %>: <%= formatNumber(topQuantity.quantity) %> units
                    <% } else { %>
                        No data yet, you have a chance to become the top miner!
                    <% } %>
                </div>
            </div>
            
            <div class="top-block">
                <div class="highlight">Monthly Top Mined Volume</div>
                <div>
                    <% if (topVolume && topVolume.miner && topVolume.volume) { %>
                        <%= topVolume.miner %>: <%= topVolume.volume %> m³
                    <% } else { %>
                        No data yet, you have a chance to become the top miner!
                    <% } %>
                </div>
            </div>
            
            <div class="top-block">
                <div class="highlight">Monthly Top Payout</div>
                <div>
                    <% if (topPayout && topPayout.pilot_name && topPayout.payout) { %>
                        <%= topPayout.pilot_name %>: <%= formatNumber(topPayout.payout) %> ISK
                    <% } else { %>
                        No data yet, you have a chance to become the top earner!
                    <% } %>
                </div>
            </div>
            
        </div>
        <div class="prices-table" style="text-align: center;">
            <h3>Item Prices</h3>
            <table style="margin: 0 auto; border-collapse: collapse; width: auto; table-layout: auto">
                <thead>
                    <tr>
                        <th style="border: 1px solid #ddd; padding: 8px;">Item Name</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">Lowest Sell Price (ISK)</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">Highest Buy Price (ISK)</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">Average Price (ISK)</th>
                    </tr>
                </thead>
                <tbody id="prices-body">
                    <% items.forEach(item => { %>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><%= item.name %></td>
                            <td id="lowest-price-<%= item.type_id %>" style="border: 1px solid #ddd; padding: 8px;">Loading...</td>
                            <td id="highest-price-<%= item.type_id %>" style="border: 1px solid #ddd; padding: 8px;">Loading...</td>
                            <td id="average-price-<%= item.type_id %>" style="border: 1px solid #ddd; padding: 8px;">Loading...</td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
            <!-- Комментарий под таблицей -->
            <div style="margin-top: 10px; font-size: 14px; color: #555;">
                Prices are sourced from The Forge region. <br>
                If the lowest price is below the average price, it will be displayed in <span style="color: red;">red</span>. <br>
                If the lowest price is above the average price, it will be displayed in <span style="color: green;">green</span>.
            </div>
        </div>
        <h2>Latest Mining Data</h2>
        <div>
            <a href="/logs?date=<%= latestDate %>" class="btn mb-3">View Full Logs for <%= latestDate %></a>
        </div>
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Corporation</th>
                    <th>Miner</th>
                    <th>Material</th>
                    <th>Quantity</th>
                    <th>Volume</th>
                </tr>
            </thead>
            <tbody>
                <% latestData.forEach(row => { %>
                    <tr>
                        <td><%= latestDate %></td> <!-- Используем форматированную дату -->
                        <td><%= row.corporation %></td>
                        <td><%= row.miner %></td>
                        <td><%= row.material %></td>
                        <td><%= row.quantity %></td>
                        <td><%= row.volume %></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
        <div class="footer">
            <p>Website created by Aamoree. If you enjoy our work, please consider donating ISK to support the cause!</p>
        </div>
    </div>
</body>
</html>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const items = <%- JSON.stringify(items) %>;

        items.forEach(item => {
            fetch(`/get-price?type_id=${item.type_id}`)
                .then(response => response.json())
                .then(data => {
                    const lowestPriceElement = document.getElementById(`lowest-price-${item.type_id}`);
                    const highestPriceElement = document.getElementById(`highest-price-${item.type_id}`);
                    const averagePriceElement = document.getElementById(`average-price-${item.type_id}`);
                    
                    lowestPriceElement.textContent = data.lowestPrice + ' ISK';
                    highestPriceElement.textContent = data.highestPrice + ' ISK';
                    averagePriceElement.textContent = data.averagePrice + ' ISK';
                    
                    // Изменение цвета текста в зависимости от сравнения цены
                    if (data.lowestPrice < data.averagePrice) {
                        lowestPriceElement.style.color = 'red';
                    } else {
                        lowestPriceElement.style.color = 'green';
                    }
                    if (data.highestPrice < data.averagePrice) {
                        highestPriceElement.style.color = 'red';
                    } else {
                        highestPriceElement.style.color = 'green';
                    }
                })
                .catch(error => {
                    console.error('Error fetching price:', error);
                    document.getElementById(`lowest-price-${item.type_id}`).textContent = 'Error loading price';
                    document.getElementById(`highest-price-${item.type_id}`).textContent = 'Error loading price';
                    document.getElementById(`average-price-${item.type_id}`).textContent = 'Error loading price';
                });
        });
    });
</script>