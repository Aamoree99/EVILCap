<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homefront Waitlist</title>
    <link rel="stylesheet" href="/hf.css">
</head>
<body>
    <header>
        <nav>
            <a href="/">Home</a>
            <a href="/hf_waitlist">Waitlist</a>
            <a href="/hf_guides">Guides</a>
            <a href="/hf_skills">Skills</a>
        </nav>
        <div class="character-info">
            <img id="character-portrait" src="" alt="Портрет персонажа" class="hidden">
            <span id="character-name" class="hidden"></span>
            <button id="auth-button" class="button">Log In</button>
        </div>
    </header>
    <main>
        <h1>Welcome to Homefront Waitlist</h1>
    </main>
    <div id="logout-modal" class="modal hidden">
        <div class="modal-content">
            <p>Do you want to log out?</p>
            <button id="logout-confirm" class="button">Yes</button>
            <button id="logout-cancel" class="button">No</button>
        </div>
    </div>
    <script>
function checkAuth() {
            fetch('/user-info')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Not authenticated');
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('character-name').innerText = data.characterName;
                    fetch(`https://esi.evetech.net/latest/characters/${data.characterID}/portrait/`)
                        .then(response => response.json())
                        .then(portraitData => {
                            document.getElementById('character-portrait').src = portraitData.px128x128;
                            document.getElementById('character-portrait').classList.remove('hidden');
                            document.getElementById('character-name').classList.remove('hidden');
                            document.getElementById('auth-button').classList.add('hidden');
                        })
                        .catch(error => console.error('Error fetching portrait:', error));
                })
                .catch(error => {
                    console.log(error.message);
                    document.getElementById('auth-button').classList.remove('hidden');
                    document.getElementById('character-portrait').classList.add('hidden');
                    document.getElementById('character-name').classList.add('hidden');
                });
        }

        document.getElementById('auth-button').addEventListener('click', () => {
            window.location.href = '/login'; // Redirect to login route
        });

        document.getElementById('character-portrait').addEventListener('click', () => {
            document.getElementById('logout-modal').classList.remove('hidden');
        });

        document.getElementById('logout-confirm').addEventListener('click', () => {
            fetch('/logout', { method: 'POST' })
                .then(() => {
                    window.location.href = '/'; // Redirect to home after logout
                })
                .catch(error => console.error('Error logging out:', error));
        });

        document.getElementById('logout-cancel').addEventListener('click', () => {
            document.getElementById('logout-modal').classList.add('hidden');
        });

        window.addEventListener('load', checkAuth);
    </script>
</body>
</html>
